- company_id = "company_#{item.id}"
%div{:id => company_id, :class => 'company'}
  %div{:class => [:item, (defined?(current) && defined?(total) && current == total - 1 ? 'last-item' : '')]}
    %h4 #{h item.start_date.to_s(:month_and_year)} - #{h item.end_date.to_s(:month_and_year)}
    %h2= h item.name

    %h5= h item.role
    %h3= h item.business_type

    - responsibilities_id = "person_#{item.person.id}_company_#{item.id}_responsiblities"
    %ul{:id => responsibilities_id}
      = render :partial => 'responsibilities/item', :collection => item.responsibilities

      - if current_user and permitted_to? :reposition, :responsibilities
        - content_for :javascript do
          = sortable_javascript_for "&person_id=#{item.person.id}&company_id=#{item.id}", "##{responsibilities_id}", '.responsibility', reposition_person_company_responsibilities_url(item.person, item)

    - projects_id = "person_#{item.person.id}_company_#{item.id}_projects"
    %div{:id => projects_id}
      = render :partial => 'projects/item', :collection => item.projects

    - if current_user
      %ul.options
        - if permitted_to? :create, :projects
          %li= link_to 'New project', new_person_company_project_path(item.person, item), :class => 'remote-link', :title => 'New project'

      - content_for :javascript do
        = dynamic_tooltip_javascript_for "##{projects_id}", 'top left'

- if current_user
  %ul.options
    - if permitted_to? :update, item
      %li= link_to 'Edit company', edit_person_company_path(item.person, item), :class => 'remote-link', :title => 'Edit company'
    - if permitted_to? :delete, item
      %li= link_to 'Delete company', delete_person_company_path(item.person, item), :class => 'remote-link', :title => 'Delete company'

  - content_for :javascript do
    = dynamic_tooltip_javascript_for "##{company_id}", 'top right'
